# 🏗️ Car Design Space - 后端架构文档

## 📋 目录
- [整体架构](#整体架构)
- [技术栈](#技术栈)
- [核心模块](#核心模块)
- [数据流](#数据流)
- [安全特性](#安全特性)
- [部署相关](#部署相关)
- [开发工具](#开发工具)

## 🏗️ 整体架构

```
backend/
├── src/                    # 源代码目录
│   ├── config/            # 配置文件
│   ├── controllers/       # 控制器层
│   ├── middleware/        # 中间件
│   ├── models/           # 数据模型层
│   ├── routes/           # 路由层
│   ├── services/         # 业务逻辑层
│   ├── sql/             # SQL脚本
│   └── app.js           # 应用入口
├── logs/                 # 日志目录
├── scripts/             # 脚本文件
└── utils/              # 工具函数
```

## 🛠️ 技术栈

- **运行环境**: Node.js
- **Web框架**: Express.js
- **数据库**: MySQL
- **ORM**: Sequelize
- **进程管理**: PM2
- **容器化**: Docker

## 📦 核心模块

### 1. 认证与授权
- 路由: `/api/auth`
- 中间件: `middleware/auth.js`
- 控制器: `controllers/authController.js`

### 2. 汽车数据管理
- 品牌: `/api/brands`
- 车系: `/api/series`
- 车型: `/api/models`

### 3. 图片管理
- 路由: `/api/images`
- 上传: `/api/upload`
- 元数据: MySQL存储

### 4. 用户系统
- 路由: `/api/users`
- 控制器: `controllers/userController.js`
- 模型: `models/User.js`

### 5. 论坛功能
- 路由: `/api/forum`
- 帖子管理
- 评论系统
- 点赞收藏

### 6. 通知系统
- 路由: `/api/notifications`
- 实时通知
- 系统消息

## 🔄 数据流

```
客户端请求 -> 路由层 -> 中间件 -> 控制器 -> 服务层 -> 数据模型层 -> 数据库
```

## 🔒 安全特性

- CORS配置
- 认证中间件
- 错误处理
- 日志记录
- 环境变量配置

## 🚀 部署相关

- Docker支持
- PM2进程管理
- 日志管理
- 环境配置

## 🛠️ 开发工具

- 脚本工具
- 数据库迁移
- 测试工具

## 💡 架构特点

1. **分层设计**
   - 清晰的责任分离
   - 模块化结构
   - 易于维护和扩展

2. **数据库架构**
   - MySQL: 结构化数据存储
   - 优化的表结构设计
   - 合理的索引策略

3. **中间件机制**
   - 请求处理管道
   - 统一的错误处理
   - 日志记录

4. **安全性考虑**
   - 认证授权
   - 数据验证
   - 错误处理
   - 日志记录

5. **可扩展性**
   - 模块化设计
   - 服务层抽象
   - 配置管理

## 📝 最佳实践

1. **代码组织**
   - 遵循模块化原则
   - 清晰的目录结构
   - 统一的命名规范

2. **错误处理**
   - 统一的错误处理中间件
   - 详细的错误日志
   - 友好的错误响应

3. **日志管理**
   - 分级日志系统
   - 日志轮转
   - 错误追踪

4. **性能优化**
   - 数据库索引
   - 缓存策略
   - 异步处理

## 🔄 维护建议

1. **日常维护**
   - 定期检查日志
   - 监控系统资源
   - 数据库优化

2. **安全更新**
   - 依赖包更新
   - 安全补丁
   - 配置检查

3. **性能优化**
   - 代码优化
   - 数据库优化
   - 缓存策略

## 📚 相关文档

- [服务器部署指南](./SERVER-DEPLOYMENT-GUIDE.md)
- [环境配置说明](./ENV-CONFIG-README.md)
- [端口冲突解决方案](./PORT-CONFLICT-README.md) 